{"version":3,"sources":["../../../../../src/lib/utils/application-commands/normalizeInputs.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n\tContextMenuCommandBuilder,\n\tSlashCommandBuilder,\n\ttype SlashCommandOptionsOnlyBuilder,\n\ttype SlashCommandSubcommandsOnlyBuilder\n} from '@discordjs/builders';\nimport { isFunction } from '@sapphire/utilities';\nimport {\n\tApplicationCommandType,\n\ttype APIApplicationCommandOption,\n\ttype RESTPostAPIApplicationCommandsJSONBody,\n\ttype RESTPostAPIChatInputApplicationCommandsJSONBody,\n\ttype RESTPostAPIContextMenuApplicationCommandsJSONBody\n} from 'discord-api-types/v10';\nimport {\n\tApplicationCommand,\n\tPermissionsBitField,\n\ttype ChatInputApplicationCommandData,\n\ttype MessageApplicationCommandData,\n\ttype UserApplicationCommandData\n} from 'discord.js';\n\nfunction isBuilder(\n\tcommand: unknown\n): command is\n\t| SlashCommandBuilder\n\t| SlashCommandSubcommandsOnlyBuilder\n\t| SlashCommandOptionsOnlyBuilder\n\t| Omit<SlashCommandBuilder, 'addSubcommand' | 'addSubcommandGroup'> {\n\treturn command instanceof SlashCommandBuilder;\n}\n\nfunction addDefaultsToChatInputJSON(data: RESTPostAPIChatInputApplicationCommandsJSONBody): RESTPostAPIChatInputApplicationCommandsJSONBody {\n\tdata.dm_permission ??= true;\n\tdata.type ??= ApplicationCommandType.ChatInput;\n\tdata.default_member_permissions ??= null;\n\n\treturn data;\n}\n\nfunction addDefaultsToContextMenuJSON(data: RESTPostAPIContextMenuApplicationCommandsJSONBody): RESTPostAPIContextMenuApplicationCommandsJSONBody {\n\tdata.dm_permission ??= true;\n\tdata.default_member_permissions ??= null;\n\n\treturn data;\n}\n\nexport function normalizeChatInputCommand(\n\tcommand:\n\t\t| ChatInputApplicationCommandData\n\t\t| SlashCommandBuilder\n\t\t| SlashCommandSubcommandsOnlyBuilder\n\t\t| SlashCommandOptionsOnlyBuilder\n\t\t| Omit<SlashCommandBuilder, 'addSubcommand' | 'addSubcommandGroup'>\n\t\t| ((builder: SlashCommandBuilder) => unknown)\n): RESTPostAPIChatInputApplicationCommandsJSONBody {\n\tif (isFunction(command)) {\n\t\tconst builder = new SlashCommandBuilder();\n\t\tcommand(builder);\n\t\treturn addDefaultsToChatInputJSON(builder.toJSON() as RESTPostAPIChatInputApplicationCommandsJSONBody);\n\t}\n\n\tif (isBuilder(command)) {\n\t\treturn addDefaultsToChatInputJSON(command.toJSON() as RESTPostAPIChatInputApplicationCommandsJSONBody);\n\t}\n\n\tconst finalObject: RESTPostAPIChatInputApplicationCommandsJSONBody = {\n\t\tname: command.name,\n\t\tname_localizations: command.nameLocalizations,\n\t\tdescription: command.description,\n\t\tdescription_localizations: command.descriptionLocalizations,\n\t\ttype: ApplicationCommandType.ChatInput,\n\t\tdm_permission: command.dmPermission,\n\t\tnsfw: command.nsfw\n\t};\n\n\tif (typeof command.defaultMemberPermissions !== 'undefined') {\n\t\tfinalObject.default_member_permissions =\n\t\t\tcommand.defaultMemberPermissions === null ? null : new PermissionsBitField(command.defaultMemberPermissions).bitfield.toString();\n\t}\n\n\tif (command.options?.length) {\n\t\tfinalObject.options = command.options.map((option) => ApplicationCommand['transformOption'](option) as APIApplicationCommandOption);\n\t}\n\n\treturn addDefaultsToChatInputJSON(finalObject);\n}\n\nexport function normalizeContextMenuCommand(\n\tcommand:\n\t\t| UserApplicationCommandData\n\t\t| MessageApplicationCommandData\n\t\t| ContextMenuCommandBuilder\n\t\t| ((builder: ContextMenuCommandBuilder) => unknown)\n): RESTPostAPIContextMenuApplicationCommandsJSONBody {\n\tif (isFunction(command)) {\n\t\tconst builder = new ContextMenuCommandBuilder();\n\t\tcommand(builder);\n\t\treturn addDefaultsToContextMenuJSON(builder.toJSON() as RESTPostAPIContextMenuApplicationCommandsJSONBody);\n\t}\n\n\tif (command instanceof ContextMenuCommandBuilder) {\n\t\treturn addDefaultsToContextMenuJSON(command.toJSON() as RESTPostAPIContextMenuApplicationCommandsJSONBody);\n\t}\n\n\tconst finalObject: RESTPostAPIContextMenuApplicationCommandsJSONBody = {\n\t\tname: command.name,\n\t\tname_localizations: command.nameLocalizations,\n\t\ttype: command.type,\n\t\tdm_permission: command.dmPermission,\n\t\tnsfw: command.nsfw\n\t};\n\n\tif (typeof command.defaultMemberPermissions !== 'undefined') {\n\t\tfinalObject.default_member_permissions =\n\t\t\tcommand.defaultMemberPermissions === null ? null : new PermissionsBitField(command.defaultMemberPermissions).bitfield.toString();\n\t}\n\n\treturn addDefaultsToContextMenuJSON(finalObject);\n}\n\nexport function convertApplicationCommandToApiData(command: ApplicationCommand): RESTPostAPIApplicationCommandsJSONBody {\n\tconst returnData = {\n\t\tname: command.name,\n\t\tname_localizations: command.nameLocalizations,\n\t\tdm_permission: command.dmPermission,\n\t\tnsfw: command.nsfw,\n\t\tdefault_member_permissions: command.defaultMemberPermissions?.bitfield.toString() ?? null\n\t} as RESTPostAPIApplicationCommandsJSONBody;\n\n\tif (command.type === ApplicationCommandType.ChatInput) {\n\t\treturnData.type = ApplicationCommandType.ChatInput;\n\t\t(returnData as RESTPostAPIChatInputApplicationCommandsJSONBody).description = command.description;\n\t\t// TODO (favna): Remove this line after website rewrite is done\n\t\t// @ts-ignore this is currently ignored for the website\n\t\t(returnData as RESTPostAPIChatInputApplicationCommandsJSONBody).description_localizations = command.descriptionLocalizations;\n\t} else if (command.type === ApplicationCommandType.Message) {\n\t\treturnData.type = ApplicationCommandType.Message;\n\t} else if (command.type === ApplicationCommandType.User) {\n\t\treturnData.type = ApplicationCommandType.User;\n\t} else {\n\t\tthrow new Error(`Unknown command type received: ${command.type}`);\n\t}\n\n\tif (command.options.length) {\n\t\treturnData.options = command.options.map((option) => ApplicationCommand['transformOption'](option as any) as APIApplicationCommandOption);\n\t}\n\n\treturn returnData;\n}\n"]}